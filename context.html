

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Context &mdash; pyws dev documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pyws dev documentation" href="index.html" />
    <link rel="up" title="Complete reference" href="complete_reference.html" />
    <link rel="next" title="Function" href="function.html" />
    <link rel="prev" title="Protocol" href="protocol.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="function.html" title="Function"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="protocol.html" title="Protocol"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pyws dev documentation</a> &raquo;</li>
          <li><a href="complete_reference.html" accesskey="U">Complete reference</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="context">
<h1>Context<a class="headerlink" href="#context" title="Permalink to this headline">¶</a></h1>
<p>A result returning by a function can depend not only on the argument values,
but also on the context which the function is running in. So we need a
mechanism to work with the context.</p>
<p>In pyws this mechanism consists of the following parts:</p>
<ul>
<li><p class="first">A protocol can extract context data from a request.</p>
<blockquote>
<div><p>As described in chapter <a class="reference internal" href="protocol.html#protocol-implementation"><em>Protocol implementation</em></a> a protocol has two
context data getters which extract context data for different cases.</p>
</div></blockquote>
</li>
<li><p class="first">A server can create a context from these data.</p>
<blockquote>
<div><p>To create a context a server calls a function <tt class="docutils literal"><span class="pre">CREATE_CONTEXT</span></tt> specified
in the server settings. This function accepts exactly one argument, namely
context data extracted from a request, creates and returns the context. If
an exception is raised and a function requires the context, the server will
stop processing the request and report an error.</p>
</div></blockquote>
</li>
<li><p class="first">A function can require and use the context.</p>
<blockquote>
<div><p>If the function was returned directly by a protocol it accepts exactly
three arguments: a server object, a request object and and a context.
Otherwise, it called with the is the function requires a context it is
passed as <tt class="docutils literal"><span class="pre">context</span></tt> keyword argument.</p>
</div></blockquote>
</li>
<li><p class="first">A server can destroy the context.</p>
<blockquote>
<div><p>To destroy the context a server calls a function <tt class="docutils literal"><span class="pre">DESTROY_CONTEXT</span></tt>
specified in the server settings. This function accepts exactly one
argument, namely the context, it cleans it, if it is necessary.</p>
</div></blockquote>
</li>
</ul>
<div class="section" id="authentcation">
<h2>Authentcation<a class="headerlink" href="#authentcation" title="Permalink to this headline">¶</a></h2>
<p>All the stuff described above can be easily used to handle authentication in
an API.</p>
<p>For instance, if we use <a class="reference internal" href="protocol.html#soap-protocol"><em>SOAP protocol</em></a>, we can
instantiate it with the following <tt class="docutils literal"><span class="pre">headers_schema</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">soap_headers_schema</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="s">&#39;Headers&#39;</span><span class="p">,</span>
    <span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then we can define a function creating a context that will check a username
and a password. If the protocol is able to extract context data according to
this schema, the function will receive a dict
<tt class="docutils literal"><span class="pre">{'username':</span> <span class="pre">'...',</span> <span class="pre">'password':</span> <span class="pre">'...'}</span></tt> as its only argument:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;password&#39;</span><span class="p">:</span> <span class="s">&#39;pass&#39;</span><span class="p">}:</span>
        <span class="k">raise</span> <span class="n">AccessDenied</span><span class="p">(</span><span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;username&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function returns a username, that will be passed as <tt class="docutils literal"><span class="pre">context</span></tt> keyword
argument to functions, that need a context. If you are working in thread safe
environment, for instance, one thread per each request, you can store the
context in thread local variables. In this case the function might just return
<tt class="docutils literal"><span class="pre">None</span></tt>.</p>
<p>If a function creating a context raises an exception, it&#8217;s ok, unless the
function being called does not need a context, otherwise pyws will report an
error.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Context</a><ul>
<li><a class="reference internal" href="#authentcation">Authentcation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="protocol.html"
                        title="previous chapter">Protocol</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="function.html"
                        title="next chapter">Function</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/context.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="function.html" title="Function"
             >next</a> |</li>
        <li class="right" >
          <a href="protocol.html" title="Protocol"
             >previous</a> |</li>
        <li><a href="index.html">pyws dev documentation</a> &raquo;</li>
          <li><a href="complete_reference.html" >Complete reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, stepank.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.
    </div>
  </body>
</html>